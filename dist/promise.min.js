!function(a,b){var c=b();"object"==typeof module&&module&&(module.exports=c),"function"==typeof define&&define.amd&&define(b),a.Promise=c}(this,function(){function a(a){return"[object Array]"===Object.prototype.toString.call(a)}function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function c(a){if(!(this instanceof c))return c._log("Promises should always be created with new Promise(). This will throw an error in the future","error"),new c(a);var b=new c.Resolver(this);this._resolver=b;try{a(function(a){b.resolve(a)},function(a){b.reject(a)})}catch(d){b.reject(d)}}function d(a){this._callbacks=[],this._errbacks=[],this.promise=a,this._status="pending",this._result=null}return b(c.prototype,{then:function(a,b){var d,e,f=new this.constructor(function(a,b){d=a,e=b});return this._resolver._addCallbacks("function"==typeof a?c._makeCallback(f,d,e,a):d,"function"==typeof b?c._makeCallback(f,d,e,b):e),f},"catch":function(a){return this.then(void 0,a)}}),c._makeCallback=function(a,b,c,d){return function(e){var f;try{f=d(e)}catch(g){return void c(g)}return f===a?void c(new TypeError("Cannot resolve a promise with itself")):void b(f)}},c._log=function(a,b){"undefined"!=typeof console&&console[b](a)},c.resolve=function(a){return a&&a.constructor===this?a:new this(function(b){b(a)})},c.reject=function(a){var b=new this(function(){});return b._resolver._result=a,b._resolver._status="rejected",b},c.all=function(b){var c=this;return new c(function(d,e){function f(a){return function(b){j[a]=b,g--,g||d(j)}}if(!a(b))return void e(new TypeError("Promise.all expects an array of values or promises"));var g=b.length,h=0,i=b.length,j=[];if(1>i)return d(j);for(;i>h;h++)c.resolve(b[h]).then(f(h),e)})},c.race=function(b){var c=this;return new c(function(d,e){if(!a(b))return void e(new TypeError("Promise.race expects an array of values or promises"));for(var f=0,g=b.length;g>f;f++)c.resolve(b[f]).then(d,e)})},c.async="undefined"!=typeof setImmediate?function(a){setImmediate(a)}:"undefined"!=typeof process&&process.nextTick?process.nextTick:function(a){setTimeout(a,0)},b(d.prototype,{fulfill:function(a){var b=this._status;("pending"===b||"accepted"===b)&&(this._result=a,this._status="fulfilled"),"fulfilled"===this._status&&(this._notify(this._callbacks,this._result),this._callbacks=[],this._errbacks=null)},reject:function(a){var b=this._status;("pending"===b||"accepted"===b)&&(this._result=a,this._status="rejected",this._errbacks.length||c._log("Promise rejected but no error handlers were registered to it","warn")),"rejected"===this._status&&(this._notify(this._errbacks,this._result),this._callbacks=null,this._errbacks=[])},resolve:function(a){"pending"===this._status&&(this._status="accepted",this._value=a,(this._callbacks&&this._callbacks.length||this._errbacks&&this._errbacks.length)&&this._unwrap(this._value))},_unwrap:function(a){var b,c=this,d=!1;if(!a||"object"!=typeof a&&"function"!=typeof a)return void c.fulfill(a);try{b=a.then,"function"==typeof b?b.call(a,function(a){d||(d=!0,c._unwrap(a))},function(a){d||(d=!0,c.reject(a))}):c.fulfill(a)}catch(e){d||c.reject(e)}},_addCallbacks:function(a,b){var c=this._callbacks,d=this._errbacks;switch(c&&c.push(a),d&&d.push(b),this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._result);break;case"rejected":this.reject(this._result)}},_notify:function(a,b){a.length&&c.async(function(){var c,d;for(c=0,d=a.length;d>c;++c)a[c](b)})}}),c.Resolver=d,c});